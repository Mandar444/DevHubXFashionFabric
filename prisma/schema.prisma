// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("user") // "user" or "admin"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Catalogue {
  id          String     @id @default(cuid())
  title       String
  subtitle    String?
  category    String
  coverImage  String     // URL to cover image
  pdfUrl      String     // URL to PDF file
  pageImages  String[]   @default([]) // Array of URLs for page images (for flip book)
  color       String     @default("bg-neutral-100") // Background color for card
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  publishedAt DateTime   @default(now())
  published   Boolean    @default(true)
  downloads   Download[] // Relation to downloads
}

model Download {
  id          String   @id @default(cuid())
  catalogueId String
  catalogue   Catalogue @relation(fields: [catalogueId], references: [id], onDelete: Cascade)
  userName    String?
  userEmail   String?
  userPhone   String?
  ipAddress   String?
  userAgent   String?
  downloadedAt DateTime @default(now())
}

model FileUpload {
  id          String   @id @default(cuid())
  fileName    String   // Original file name
  storagePath String   // Path in Supabase storage
  fileType    String   // "pdf" or "image"
  fileSize    Int      // File size in bytes
  mimeType    String   // MIME type of the file
  uploadedBy  String?  // User ID or email of admin who uploaded
  catalogueId String?  // Optional: if file is linked to a catalogue
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CatalogueSubmission {
  id          String   @id @default(cuid())
  firstName   String
  lastName    String
  email       String
  companyName String?
  phoneNumber String
  country     String
  ipAddress   String?
  userAgent   String?
  otpVerified Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([email])
  @@index([phoneNumber])
  @@index([createdAt])
}
